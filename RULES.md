# カタン（The Settlers of Catan）ゲームルール概要および設定仕様

このドキュメントでは、本シミュレーターが準拠するカタンの公式ルール（主に盤面生成に関して）をまとめます。

## 1. コンポーネント（Component）

### 地形タイル（Terrain Hexes） - 全19枚
- **森林（Forest）**: 4枚 → 木材（Wood）
- **牧草地（Pasture）**: 4枚 → 羊毛（Wool/Sheep）
- **畑（Fields）**: 4枚 → 小麦（Wheat/Grain）
- **丘陵（Hills）**: 3枚 → レンガ（Brick/Clay）
- **山地（Mountains）**: 3枚 → 鉄鉱石（Ore）
- **砂漠（Desert）**: 1枚 → お金（N/A）

### 数字チップ（Number Tokens） - 全18枚
以下の数字が割り当てられます（確率ドット数）：
- **2**: 1枚（1点）
- **3**: 2枚（2点）
- **4**: 2枚（3点）
- **5**: 2枚（4点）
- **6**: 2枚（5点・赤字）
- **8**: 2枚（5点・赤字）
- **9**: 2枚（4点）
- **10**: 2枚（3点）
- **11**: 2枚（2点）
- **12**: 1枚（1点）

※ 砂漠タイルには数字チップを置きません。盗賊の初期配置場所となります。

### 港（Ports） - 全9箇所
盤面の海岸線に配置される交易用の港です。
- **3:1 港（Generic/Any）**: 4箇所
  - 任意の資源3枚を好きな資源1枚と交換可能。
- **2:1 港（Specific Resource）**: 各資源1箇所ずつ（計5箇所）
  - 前提となる資源2枚を好きな資源1枚と交換可能。
  - 木材港、レンガ港、羊毛港、小麦港、鉄鉱石港

---

## 2. セットアップルール（Setup Rules）

### 初期マップ配置（Map Generation）
標準的なカタンには「初心者用配置（Beginner Setup）」と「可変配置（Variable Setup）」があります。本シミュレーターは主に**可変配置**を目指します。

1. **地形タイルの配置**:
   - 19枚の地形タイルをランダムにシャッフルし、規定のレイアウト（3-4-5-4-3の六角形）に配置します。
   - 砂漠の配置位置もランダムとなります。

2. **数字チップの配置**:
   - 18枚の数字チップを以下のルールに従って配置します。
   - **赤数字の隣接禁止**: 「6」と「8」の数字トークンは、決して隣同士（辺を共有する状態）になってはいけません。これはゲームバランスを保つための重要なルールです。
   - 一般的には、外周の角から渦巻き状（アルファベット順 A-R）に配置することが推奨されますが、完全にランダムに配置する場合でも6と8の隣接は避けるべきです。
   - 砂漠タイルはスキップします。

3. **港の配置（Port Placement）**:
   - 港の「場所（物理的な海岸線の位置）」はボードの枠組み（フレーム）によって固定されています。
   - 港の「種類（3:1か、どの資源の2:1か）」は、可変セットアップの場合、**ランダムに配置**することが可能です。
   - 初心者用配置では港の種類も固定されていますが、リプレイ性を高めるためにランダム化（港チップを裏向きに置いてめくる等）が採用されることが多いです。

---

## 3. シミュレーター実装仕様（Implementation Specs）

### 現状の実装状況と課題
- **地形生成**: ランダムに配置（実装済み）
- **数字生成**: ランダムに配置（実装済み）
  - **課題**: 「6と8の隣接禁止ルール」が未実装。現在は完全ランダムのため、6と8が隣り合う可能性がある。
- **港の配置**: 固定配置（実装済み）
  - **課題**: 港の種類（Resource Type）が固定されている。
  - **改善案**: 9箇所の港の位置（Location）は固定のまま、割り当てる港の種類（Type）をゲーム開始時にランダムにシャッフルする機能を追加する。

### 今後の実装計画
1. **港のランダム化**: `Generic` x4, `Wood` x1, `Brick` x1, `Sheep` x1, `Wheat` x1, `Ore` x1 のセットをシャッフルし、9箇所の固定位置に割り当てる。
2. **数字配置アルゴリズムの改善**: 6と8が隣接しないように再配置を行うロジック、または渦巻き状の配置アルゴリズムを導入する。

以上
